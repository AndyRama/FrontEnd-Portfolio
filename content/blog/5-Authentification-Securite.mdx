---
title: 'üöÄ Roadmap - Authentification & S√©curit√© avec Next.js'
excerpt: "Authentification et la gestion des sessions avec Next.js. On y couvre des concepts cl√©s comme la cr√©ation de routes s√©curis√©es, la gestion des tokens, les middlewares, et l'int√©gration de Next-Auth."
date: '2024-06-17'
author: 'Andy Ramaroson'
categories:
  - title: 'NextJs'
  - title: 'Concepts'
type: 'Post'
image: '/images/perplexity-ai-vs-chatgpt.jpg'
---

üöÄ Roadmap - Authentification & S√©curit√© avec Next.js

1. Comprendre l'Authentification

    Authentification (AuthN) : v√©rifier l'identit√© de l'utilisateur.
    Autorisation (AuthZ) : contr√¥ler l'acc√®s aux ressources en fonction des r√¥les.
    Types :
        Session-based (Cookies)
        Token-based (JWT)

2. Cr√©er des Routes Priv√©es & Publiques

    Routes publiques : accessibles √† tous (ex : page d'accueil).
    Routes priv√©es : prot√©g√©es par une v√©rification d'authentification.
    Exemple de guard :

    ```jsx
    export default function ProtectedPage({ session }) {
      if (!session) redirect('/login');
      return <Dashboard />;
    }
    ```

3. Formulaire de Connexion (Login Form)

    Gestion de l‚Äô√©tat, validation, gestion des erreurs :

    ```jsx
    const [email, setEmail] = useState('');
    const [error, setError] = useState(null);

    const handleSubmit = async (e) => {
      e.preventDefault();
      try {
        await login({ email });
      } catch (err) {
        setError('Invalid credentials');
      }
    };
    ```

4. Cr√©ation d‚Äôune Authentification avec Credentials & Persistance

    V√©rification des identifiants en base de donn√©es.
    Persistance via cookies s√©curis√©s.
    Exemple de hash de mot de passe avec bcrypt :

    ```jsx
    const hashedPassword = await bcrypt.hash(password, 10);
    ```

5. G√©rer l'Encryption / Salt

    Salt : cha√Æne al√©atoire ajout√©e pour s√©curiser les mots de passe.
    Utilisation de bcrypt pour le hash + salt.

6. Session Management avec Cookies

    Stockage des tokens/session dans des cookies s√©curis√©s (HTTPOnly).
    Exemple :

    ```jsx
    cookies().set('session', token, { httpOnly: true, secure: true });
    ```

7. Session Management avec JWT (JSON Web Token)

    Encodage des donn√©es utilisateur dans un token sign√©.
    Exemple avec jsonwebtoken:

    ```jsx
    const token = jwt.sign({ userId: user.id }, 'secret', { expiresIn: '1h' });
    ```

8. Le DTO Pattern (Data Transfer Object)

    S√©curise les √©changes de donn√©es entre client et serveur.
    Structure des donn√©es coh√©rente et valid√©e.

9. HOC (Higher-Order Component) pour la Session Utilisateur

    Cr√©er des HOC pour prot√©ger des composants :

    ```jsx
    const withAuth = (Component) => (props) =>
      props.session ? <Component {...props} /> : <Redirect to="/login" />;
    ```

10. Auth Redirection C√¥t√© Client

    Redirection conditionnelle selon l‚Äô√©tat de la session :

    ```jsx
    if (!session) router.push('/login');
    ```

11. Auth Redirection C√¥t√© Serveur

    V√©rification et redirection d√®s la phase SSR :

    ```jsx
    export async function getServerSideProps(context) {
      const session = await getSession(context);
      if (!session) return { redirect: { destination: '/login' } };
      return { props: { session } };
    }
    ```

12. Database Session Management

    Stocker les sessions en base de donn√©es pour plus de persistance.
    Utilisation d‚Äôune table d√©di√©e aux sessions (ex : PostgreSQL, MongoDB).

13. Session Strategy Pattern

    Strat√©gie d'authentification flexible :
        JWT Strategy pour des APIs stateless.
        Database Strategy pour des sessions persistantes.

14. Le Middleware Next.js

    Interception des requ√™tes pour appliquer des r√®gles globales (auth, redirection, etc.) :

    ```jsx
    export function middleware(req) {
      const token = req.cookies.get('token');
      if (!token) return NextResponse.redirect('/login');
    }
    ```

15. Middleware - AuthZ (Authorization)

    Gestion des permissions par r√¥le :

    ```jsx
    if (user.role !== 'admin') return NextResponse.redirect('/unauthorized');
    ```

16. Safe Action (Server Action Authorization)

    Protection des Server Actions contre les abus :
        V√©rification du r√¥le et de la session avant d‚Äôex√©cuter des actions sensibles.

17. Authentification avec Next-Auth

    NextAuth.js simplifie la gestion de l'authentification :
        Support des providers OAuth (Google, GitHub, etc.)
        JWT, gestion des sessions, s√©curisation des routes.

    Installation :

    ```bash
    npm install next-auth
    ```

    Configuration :

    ```jsx
    import NextAuth from 'next-auth';
    import CredentialsProvider from 'next-auth/providers/credentials';

    export const authOptions = {
      providers: [
        CredentialsProvider({
          authorize(credentials) {
            const user = checkUser(credentials);
            if (user) return user;
            return null;
          },
        }),
      ],
      session: { strategy: 'jwt' },
    };

    export default NextAuth(authOptions);
    ```

18. Exercices Pratiques

    - Syst√®me d'auth complet (login, register, dashboard s√©curis√©)
    - Impl√©mentation JWT + Cookies s√©curis√©s
    - App Next-Auth avec gestion des r√¥les (admin/user)

---

### Exemple de Hook `useEffect` :

```jsx
import { useEffect } from 'react';

useEffect(() => {
  console.log('Composant hydrat√©');
}, []);
